<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Golf Multiplayer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: linear-gradient(135deg, #1a5f23, #0d3b1a); color: white; min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: rgba(0,0,0,0.7); border-radius: 15px; padding: 20px; }
        h1 { text-align: center; margin-bottom: 20px; color: #4CAF50; }
        .game-container { display: flex; gap: 20px; }
        .course-container { flex: 3; }
        .sidebar { flex: 1; background: rgba(255,255,255,0.1); border-radius: 10px; padding: 15px; min-width: 300px; }
        .golf-course { background: linear-gradient(to bottom, #7CB342, #4CAF50); height: 400px; border-radius: 10px; position: relative; cursor: crosshair; border: 3px solid #5D4037; }
        .hole { width: 40px; height: 40px; background: black; border-radius: 50%; position: absolute; top: 100px; left: 750px; border: 2px solid #333; }
        .ball { width: 25px; height: 25px; border-radius: 50%; position: absolute; transition: all 0.3s; }
        .player-ball { border: 3px solid #FFEB3B; }
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .control-btn { background: #2196F3; color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer; }
        .control-btn.shoot { background: #FF9800; grid-column: span 2; }
        .power-meter { margin: 15px 0; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 8px; }
        .power-bar { height: 20px; background: linear-gradient(to right, #4CAF50, #FF9800, #F44336); border-radius: 10px; width: 0%; }
        .chat-container { margin-top: 20px; background: rgba(0,0,0,0.5); border-radius: 10px; padding: 15px; height: 200px; display: flex; flex-direction: column; }
        .chat-messages { flex: 1; overflow-y: auto; margin-bottom: 10px; }
        .chat-input { display: flex; gap: 5px; }
        .chat-input input { flex: 1; padding: 8px; border-radius: 5px; border: none; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: rgba(0,0,0,0.9); padding: 30px; border-radius: 15px; text-align: center; max-width: 400px; width: 90%; }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚õ≥ Mini Golf Multiplayer</h1>
        <div class="game-container">
            <div class="course-container">
                <div style="display: flex; justify-content: space-between; margin-bottom: 15px; padding: 10px; background: rgba(0,0,0,0.5); border-radius: 8px;">
                    <div>Buca: <span id="hole-number">1</span>/9</div>
                    <div>Stato: <span id="connection-text">Disconnesso</span></div>
                </div>
                
                <div class="golf-course" id="course">
                    <div class="hole"></div>
                </div>
                
                <div class="power-meter">
                    <div>Potenza: <span id="power-percent">0%</span></div>
                    <div class="power-bar" id="power-bar"></div>
                </div>
                
                <div class="controls">
                    <button class="control-btn" id="aim-btn" onclick="toggleAimMode()">üîç Mira</button>
                    <button class="control-btn" id="reset-btn" onclick="resetAim()">‚Ü∫ Reset</button>
                    <button class="control-btn shoot" id="shoot-btn" onclick="startPowerCharge()" disabled>‚õ≥ TIRA</button>
                </div>
            </div>
            
            <div class="sidebar">
                <div style="padding: 10px; background: rgba(76,175,80,0.3); border-radius: 5px; margin-bottom: 15px; text-align: center;">
                    <span id="status-text">Disconnesso</span>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <h3>Giocatori (<span id="players-count">0</span>)</h3>
                    <div id="players-container">
                        <div style="padding: 10px; background: rgba(255,255,255,0.1); border-radius: 5px; text-align: center;">
                            Nessun giocatore
                        </div>
                    </div>
                </div>
                
                <div class="chat-container">
                    <h3>üí¨ Chat</h3>
                    <div class="chat-messages" id="chat-messages">
                        <div style="padding: 8px; background: rgba(255,255,255,0.1); border-radius: 5px; margin-bottom: 5px;">
                            Sistema: Inserisci il nome per iniziare
                        </div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="chat-input" placeholder="Scrivi..." disabled>
                        <button onclick="sendChatMessage()" disabled>Invia</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="welcome-modal">
        <div class="modal-content">
            <h2>üéÆ Mini Golf Multiplayer</h2>
            <p>Inserisci il tuo nome:</p>
            <input type="text" id="player-name" placeholder="Il tuo nome" value="Giocatore" style="width: 100%; padding: 12px; margin: 10px 0; border-radius: 5px; border: none;">
            <button onclick="joinGame()" style="width: 100%; padding: 12px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;">
                üéØ Inizia a Giocare
            </button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        let socket;
        let gameState = { isAiming: false, isCharging: false, power: 0, powerDirection: 1, chargeInterval: null, aimAngle: 0 };

        function joinGame() {
            const playerName = document.getElementById('player-name').value.trim() || 'Giocatore';
            document.getElementById('welcome-modal').style.display = 'none';
            
            // Connessione automatica al server Render
            socket = io();
            
            socket.on('connect', () => {
                updateStatus("‚úÖ Connesso!");
                document.getElementById('chat-input').disabled = false;
                document.querySelector('.chat-input button').disabled = false;
                
                socket.emit('player_join', { name: playerName });
            });
            
            socket.on('players_update', (players) => {
                updatePlayersList(players);
                updateBalls(players);
            });
            
            socket.on('player_shot', (data) => {
                animateShot(data);
            });
            
            socket.on('chat_message', (data) => {
                addChatMessage(data.player, data.message);
            });
        }

        function toggleAimMode() {
            gameState.isAiming = !gameState.isAiming;
            const btn = document.getElementById('aim-btn');
            const shootBtn = document.getElementById('shoot-btn');
            
            if (gameState.isAiming) {
                btn.textContent = "‚ùå Esci Mira";
                shootBtn.disabled = false;
            } else {
                btn.textContent = "üîç Attiva Mira";
                shootBtn.disabled = true;
            }
        }

        function startPowerCharge() {
            gameState.isCharging = true;
            gameState.power = 0;
            gameState.powerDirection = 1;
            
            const shootBtn = document.getElementById('shoot-btn');
            shootBtn.textContent = "‚õ≥ FERMA!";
            shootBtn.onclick = executeShot;
            
            gameState.chargeInterval = setInterval(() => {
                gameState.power += gameState.powerDirection * 3;
                if (gameState.power >= 100) gameState.powerDirection = -1;
                if (gameState.power <= 0) gameState.powerDirection = 1;
                document.getElementById('power-bar').style.width = gameState.power + '%';
                document.getElementById('power-percent').textContent = gameState.power + '%';
            }, 50);
        }

        function executeShot() {
            clearInterval(gameState.chargeInterval);
            const power = gameState.power;
            gameState.isCharging = gameState.isAiming = false;
            
            document.getElementById('aim-btn').textContent = "üîç Attiva Mira";
            document.getElementById('shoot-btn').textContent = "‚õ≥ TIRA";
            document.getElementById('shoot-btn').onclick = startPowerCharge;
            document.getElementById('shoot-btn').disabled = true;
            
            if (socket) {
                socket.emit('player_shot', {
                    startPos: { x: 50, y: 450 },
                    endPos: { x: 50 + (power * 2), y: 450 - (power * 2) },
                    power: power
                });
            }
        }

        function updateStatus(message) {
            document.getElementById('status-text').textContent = message;
            document.getElementById('connection-text').textContent = message.includes('‚úÖ') ? 'Connesso' : 'Disconnesso';
        }

        function updatePlayersList(players) {
            const container = document.getElementById('players-container');
            const count = document.getElementById('players-count');
            
            count.textContent = Object.keys(players).length;
            container.innerHTML = '';
            
            Object.values(players).forEach(player => {
                const div = document.createElement('div');
                div.className = 'player-item';
                div.innerHTML = `<strong>${player.name}</strong> - ${player.shots} colpi`;
                div.style.padding = '8px';
                div.style.margin = '5px 0';
                div.style.background = 'rgba(255,255,255,0.1)';
                div.style.borderRadius = '5px';
                container.appendChild(div);
            });
        }

        function addChatMessage(sender, message) {
            const container = document.getElementById('chat-messages');
            const div = document.createElement('div');
            div.innerHTML = `<strong>${sender}:</strong> ${message}`;
            div.style.padding = '5px';
            div.style.background = 'rgba(255,255,255,0.1)';
            div.style.borderRadius = '3px';
            div.style.marginBottom = '5px';
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (message && socket) {
                socket.emit('chat_message', { message: message });
                input.value = '';
            }
        }

        function resetAim() {
            gameState.aimAngle = 0;
        }

        function animateShot(data) {
            // Animazione base
            console.log('Animazione colpo di:', data.playerName);
        }

        function updateBalls(players) {
            // Aggiorna palline
            console.log('Aggiorna palline:', players);
        }
    </script>
</body>
</html>
